function Readability(doc,options){if(options&&options.documentElement)doc=options,options=arguments[2];else if(!doc||!doc.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(options=options||{},this._doc=doc,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!options.debug,this._maxElemsToParse=options.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=options.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=options.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(options.classesToPreserve||[]),this._keepClasses=!!options.keepClasses,this._serializer=options.serializer||function(el){return el.innerHTML},this._disableJSONLD=!!options.disableJSONLD,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let logNode=function(node){if(node.nodeType==node.TEXT_NODE)return`${node.nodeName} ("${node.textContent}")`;let attrPairs=Array.from(node.attributes||[],(function(attr){return`${attr.name}="${attr.value}"`})).join(" ");return`<${node.localName} ${attrPairs}>`};this.log=function(){if("undefined"!=typeof dump){var msg=Array.prototype.map.call(arguments,(function(x){return x&&x.nodeName?logNode(x):x})).join(" ");dump("Reader: (Readability) "+msg+"\n")}else if("undefined"!=typeof console){let args=Array.from(arguments,arg=>arg&&arg.nodeType==this.ELEMENT_NODE?logNode(arg):arg);args.unshift("Reader: (Readability)"),console.log.apply(console,args)}}}else this.log=function(){}}Readability.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote|top|swipe|bar|author|follow/i,okMaybeItsACandidate:/(?<!title.*)(and|article|body|column|content|main|shadow)(?!.*title)/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget|top|swipe|bar|author|follow|logo/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent:function(articleContent){this._fixRelativeUris(articleContent),this._simplifyNestedElements(articleContent),this._keepClasses||this._cleanClasses(articleContent)},_removeNodes:function(nodeList,filterFn){if(this._docJSDOMParser&&nodeList._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var i=nodeList.length-1;i>=0;i--){var node=nodeList[i],parentNode=node.parentNode;parentNode&&(filterFn&&!filterFn.call(this,node,i,nodeList)||parentNode.removeChild(node))}},_replaceNodeTags:function(nodeList,newTagName){if(this._docJSDOMParser&&nodeList._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const node of nodeList)this._setNodeTag(node,newTagName)},_forEachNode:function(nodeList,fn){Array.prototype.forEach.call(nodeList,fn,this)},_findNode:function(nodeList,fn){return Array.prototype.find.call(nodeList,fn,this)},_someNode:function(nodeList,fn){return Array.prototype.some.call(nodeList,fn,this)},_everyNode:function(nodeList,fn){return Array.prototype.every.call(nodeList,fn,this)},_concatNodeLists:function(){var slice=Array.prototype.slice,args=slice.call(arguments),nodeLists=args.map((function(list){return slice.call(list)}));return Array.prototype.concat.apply([],nodeLists)},_getAllNodesWithTag:function(node,tagNames){return node.querySelectorAll?node.querySelectorAll(tagNames.join(",")):[].concat.apply([],tagNames.map((function(tag){var collection=node.getElementsByTagName(tag);return Array.isArray(collection)?collection:Array.from(collection)})))},_cleanClasses:function(node){var classesToPreserve=this._classesToPreserve,className=(node.getAttribute("class")||"").split(/\s+/).filter((function(cls){return-1!=classesToPreserve.indexOf(cls)})).join(" ");for(className?node.setAttribute("class",className):node.removeAttribute("class"),node=node.firstElementChild;node;node=node.nextElementSibling)this._cleanClasses(node)},_fixRelativeUris:function(articleContent){var baseURI=this._doc.baseURI,documentURI=this._doc.documentURI;function toAbsoluteURI(uri){if(baseURI==documentURI&&"#"==uri.charAt(0))return uri;try{return new URL(uri,baseURI).href}catch(ex){}return uri}var links=this._getAllNodesWithTag(articleContent,["a"]);this._forEachNode(links,(function(link){var href=link.getAttribute("href");if(href)if(0===href.indexOf("javascript:"))if(1===link.childNodes.length&&link.childNodes[0].nodeType===this.TEXT_NODE){var text=this._doc.createTextNode(link.textContent);link.parentNode.replaceChild(text,link)}else{for(var container=this._doc.createElement("span");link.firstChild;)container.appendChild(link.firstChild);link.parentNode.replaceChild(container,link)}else link.setAttribute("href",toAbsoluteURI(href))}));var medias=this._getAllNodesWithTag(articleContent,["img","picture","figure","video","audio","source"]);this._forEachNode(medias,(function(media){var src=media.getAttribute("src"),poster=media.getAttribute("poster"),srcset=media.getAttribute("srcset");if(src&&media.setAttribute("src",toAbsoluteURI(src)),poster&&media.setAttribute("poster",toAbsoluteURI(poster)),srcset){var newSrcset=srcset.replace(this.REGEXPS.srcsetUrl,(function(_,p1,p2,p3){return toAbsoluteURI(p1)+(p2||"")+p3}));media.setAttribute("srcset",newSrcset)}}))},_simplifyNestedElements:function(articleContent){for(var node=articleContent;node;){if(node.parentNode&&["DIV","SECTION"].includes(node.tagName)&&(!node.id||!node.id.startsWith("readability"))){if(this._isElementWithoutContent(node)){node=this._removeAndGetNext(node);continue}if(this._hasSingleTagInsideElement(node,"DIV")||this._hasSingleTagInsideElement(node,"SECTION")){for(var child=node.children[0],i=0;i<node.attributes.length;i++)child.setAttribute(node.attributes[i].name,node.attributes[i].value);node.parentNode.replaceChild(child,node),node=child;continue}}node=this._getNextNode(node)}},_getArticleTitle:function(){var doc=this._doc,curTitle="",origTitle="";try{"string"!=typeof(curTitle=origTitle=doc.title.trim())&&(curTitle=origTitle=this._getInnerText(doc.getElementsByTagName("title")[0]))}catch(e){}var titleHadHierarchicalSeparators=!1;function wordCount(str){return str.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(curTitle))titleHadHierarchicalSeparators=/ [\\\/>»] /.test(curTitle),wordCount(curTitle=origTitle.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"))<3&&(curTitle=origTitle.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"));else if(-1!==curTitle.indexOf(": ")){var headings=this._concatNodeLists(doc.getElementsByTagName("h1"),doc.getElementsByTagName("h2")),trimmedTitle=curTitle.trim(),match;this._someNode(headings,(function(heading){return heading.textContent.trim()===trimmedTitle}))||(wordCount(curTitle=origTitle.substring(origTitle.lastIndexOf(":")+1))<3?curTitle=origTitle.substring(origTitle.indexOf(":")+1):wordCount(origTitle.substr(0,origTitle.indexOf(":")))>5&&(curTitle=origTitle))}else if(curTitle.length>150||curTitle.length<15){var hOnes=doc.getElementsByTagName("h1");1===hOnes.length&&(curTitle=this._getInnerText(hOnes[0]))}var curTitleWordCount=wordCount(curTitle=curTitle.trim().replace(this.REGEXPS.normalize," "));return curTitleWordCount<=4&&(!titleHadHierarchicalSeparators||curTitleWordCount!=wordCount(origTitle.replace(/[\|\-\\\/>»]+/g,""))-1)&&(curTitle=origTitle),curTitle},_prepDocument:function(){var doc=this._doc;this._removeNodes(this._getAllNodesWithTag(doc,["style"])),doc.body&&this._replaceBrs(doc.body),this._replaceNodeTags(this._getAllNodesWithTag(doc,["font"]),"SPAN")},_nextNode:function(node){for(var next=node;next&&next.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(next.textContent);)next=next.nextSibling;return next},_replaceBrs:function(elem){this._forEachNode(this._getAllNodesWithTag(elem,["br"]),(function(br){for(var next=br.nextSibling,replaced=!1;(next=this._nextNode(next))&&"BR"==next.tagName;){replaced=!0;var brSibling=next.nextSibling;next.parentNode.removeChild(next),next=brSibling}if(replaced){var p=this._doc.createElement("p");for(br.parentNode.replaceChild(p,br),next=p.nextSibling;next;){if("BR"==next.tagName){var nextElem=this._nextNode(next.nextSibling);if(nextElem&&"BR"==nextElem.tagName)break}if(!this._isPhrasingContent(next))break;var sibling=next.nextSibling;p.appendChild(next),next=sibling}for(;p.lastChild&&this._isWhitespace(p.lastChild);)p.removeChild(p.lastChild);"P"===p.parentNode.tagName&&this._setNodeTag(p.parentNode,"DIV")}}))},_setNodeTag:function(node,tag){if(this.log("_setNodeTag",node,tag),this._docJSDOMParser)return node.localName=tag.toLowerCase(),node.tagName=tag.toUpperCase(),node;for(var replacement=node.ownerDocument.createElement(tag);node.firstChild;)replacement.appendChild(node.firstChild);node.parentNode.replaceChild(replacement,node),node.readability&&(replacement.readability=node.readability);for(var i=0;i<node.attributes.length;i++)try{replacement.setAttribute(node.attributes[i].name,node.attributes[i].value)}catch(ex){}return replacement},_prepArticle:function(articleContent){this._cleanStyles(articleContent),this._markDataTables(articleContent),this._fixLazyImages(articleContent),this._cleanConditionally(articleContent,"form"),this._cleanConditionally(articleContent,"fieldset"),this._clean(articleContent,"object"),this._clean(articleContent,"embed"),this._clean(articleContent,"footer"),this._clean(articleContent,"link"),this._clean(articleContent,"aside");var shareElementThreshold=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(articleContent.children,(function(topCandidate){this._cleanMatchedNodes(topCandidate,(function(node,matchString){return this.REGEXPS.shareElements.test(matchString)&&node.textContent.length<shareElementThreshold}))})),this._clean(articleContent,"iframe"),this._clean(articleContent,"input"),this._clean(articleContent,"textarea"),this._clean(articleContent,"select"),this._clean(articleContent,"button"),this._cleanHeaders(articleContent),this._cleanConditionally(articleContent,"table"),this._cleanConditionally(articleContent,"ul"),this._cleanConditionally(articleContent,"div"),this._replaceNodeTags(this._getAllNodesWithTag(articleContent,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(articleContent,["p"]),(function(paragraph){var imgCount,embedCount,objectCount,iframeCount,totalCount;return 0===paragraph.getElementsByTagName("img").length+paragraph.getElementsByTagName("embed").length+paragraph.getElementsByTagName("object").length+paragraph.getElementsByTagName("iframe").length&&!this._getInnerText(paragraph,!1)})),this._forEachNode(this._getAllNodesWithTag(articleContent,["br"]),(function(br){var next=this._nextNode(br.nextSibling);next&&"P"==next.tagName&&br.parentNode.removeChild(br)})),this._forEachNode(this._getAllNodesWithTag(articleContent,["table"]),(function(table){var tbody=this._hasSingleTagInsideElement(table,"TBODY")?table.firstElementChild:table;if(this._hasSingleTagInsideElement(tbody,"TR")){var row=tbody.firstElementChild;if(this._hasSingleTagInsideElement(row,"TD")){var cell=row.firstElementChild;cell=this._setNodeTag(cell,this._everyNode(cell.childNodes,this._isPhrasingContent)?"P":"DIV"),table.parentNode.replaceChild(cell,table)}}}))},_initializeNode:function(node){switch(node.readability={contentScore:0},node.tagName){case"DIV":node.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":node.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":node.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":node.readability.contentScore-=5}node.readability.contentScore+=this._getClassWeight(node)},_removeAndGetNext:function(node){var nextNode=this._getNextNode(node,!0);return node.parentNode.removeChild(node),nextNode},_getNextNode:function(node,ignoreSelfAndKids){if(!ignoreSelfAndKids&&node.firstElementChild)return node.firstElementChild;if(node.nextElementSibling)return node.nextElementSibling;do{node=node.parentNode}while(node&&!node.nextElementSibling);return node&&node.nextElementSibling},_textSimilarity:function(textA,textB){var tokensA=textA.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),tokensB=textB.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),uniqTokensB,distanceB;return tokensA.length&&tokensB.length?1-tokensB.filter(token=>!tokensA.includes(token)).join(" ").length/tokensB.join(" ").length:0},_checkByline:function(node,matchString){if(this._articleByline)return!1;if(void 0!==node.getAttribute)var rel=node.getAttribute("rel"),itemprop=node.getAttribute("itemprop");return!(!("author"===rel||itemprop&&-1!==itemprop.indexOf("author")||this.REGEXPS.byline.test(matchString))||!this._isValidByline(node.textContent))&&(this._articleByline=node.textContent.trim(),!0)},_getNodeAncestors:function(node,maxDepth){maxDepth=maxDepth||0;for(var i=0,ancestors=[];node.parentNode&&(ancestors.push(node.parentNode),!maxDepth||++i!==maxDepth);)node=node.parentNode;return ancestors},_grabArticle:function(page){this.log("**** grabArticle ****");var doc=this._doc,isPaging=null!==page;if(!(page=page||this._doc.body))return this.log("No body found in document. Abort."),null;for(var pageCacheHtml=page.innerHTML;;){this.log("Starting grabArticle loop");var stripUnlikelyCandidates=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),elementsToScore=[],node=this._doc.documentElement;let shouldRemoveTitleHeader=!0;for(;node;){var matchString=node.className+" "+node.id;if(this._isProbablyVisible(node))if(this._checkByline(node,matchString))node=this._removeAndGetNext(node);else if(shouldRemoveTitleHeader&&this._headerDuplicatesTitle(node))this.log("Removing header: ",node.textContent.trim(),this._articleTitle.trim()),shouldRemoveTitleHeader=!1,node=this._removeAndGetNext(node);else{if(stripUnlikelyCandidates){if(this.REGEXPS.unlikelyCandidates.test(matchString)&&!this.REGEXPS.okMaybeItsACandidate.test(matchString)&&!this._hasAncestorTag(node,"table")&&!this._hasAncestorTag(node,"code")&&"BODY"!==node.tagName&&"A"!==node.tagName){this.log("Removing unlikely candidate - "+matchString),node=this._removeAndGetNext(node);continue}if(this.UNLIKELY_ROLES.includes(node.getAttribute("role"))){this.log("Removing content with role "+node.getAttribute("role")+" - "+matchString),node=this._removeAndGetNext(node);continue}}if("DIV"!==node.tagName&&"SECTION"!==node.tagName&&"HEADER"!==node.tagName&&"H1"!==node.tagName&&"H2"!==node.tagName&&"H3"!==node.tagName&&"H4"!==node.tagName&&"H5"!==node.tagName&&"H6"!==node.tagName||!this._isElementWithoutContent(node)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(node.tagName)&&elementsToScore.push(node),"DIV"===node.tagName){for(var p=null,childNode=node.firstChild;childNode;){var nextSibling=childNode.nextSibling;if(this._isPhrasingContent(childNode))null!==p?p.appendChild(childNode):this._isWhitespace(childNode)||(p=doc.createElement("p"),node.replaceChild(p,childNode),p.appendChild(childNode));else if(null!==p){for(;p.lastChild&&this._isWhitespace(p.lastChild);)p.removeChild(p.lastChild);p=null}childNode=nextSibling}if(this._hasSingleTagInsideElement(node,"P")&&this._getLinkDensity(node)<.25){var newNode=node.children[0];node.parentNode.replaceChild(newNode,node),node=newNode,elementsToScore.push(node)}else this._hasChildBlockElement(node)||(node=this._setNodeTag(node,"P"),elementsToScore.push(node))}node=this._getNextNode(node)}else node=this._removeAndGetNext(node)}else this.log("Removing hidden node - "+matchString),node=this._removeAndGetNext(node)}var candidates=[];this._forEachNode(elementsToScore,(function(elementToScore){if(elementToScore.parentNode&&void 0!==elementToScore.parentNode.tagName){var innerText=this._getInnerText(elementToScore);if(!(innerText.length<25)){var ancestors=this._getNodeAncestors(elementToScore,5);if(0!==ancestors.length){var contentScore=0;contentScore+=1,contentScore+=innerText.split(",").length,contentScore+=Math.min(Math.floor(innerText.length/100),3),this._forEachNode(ancestors,(function(ancestor,level){if(ancestor.tagName&&ancestor.parentNode&&void 0!==ancestor.parentNode.tagName){if(void 0===ancestor.readability&&(this._initializeNode(ancestor),candidates.push(ancestor)),0===level)var scoreDivider=1;else scoreDivider=1===level?2:3*level;ancestor.readability.contentScore+=contentScore/scoreDivider}}))}}}}));for(var topCandidates=[],c=0,cl=candidates.length;c<cl;c+=1){var candidate=candidates[c],candidateScore=candidate.readability.contentScore*(1-this._getLinkDensity(candidate));candidate.readability.contentScore=candidateScore,this.log("Candidate:",candidate,"with score "+candidateScore);for(var t=0;t<this._nbTopCandidates;t++){var aTopCandidate=topCandidates[t];if(!aTopCandidate||candidateScore>aTopCandidate.readability.contentScore){topCandidates.splice(t,0,candidate),topCandidates.length>this._nbTopCandidates&&topCandidates.pop();break}}}var topCandidate=topCandidates[0]||null,neededToCreateTopCandidate=!1,parentOfTopCandidate;if(null===topCandidate||"BODY"===topCandidate.tagName){for(topCandidate=doc.createElement("DIV"),neededToCreateTopCandidate=!0;page.firstChild;)this.log("Moving child out:",page.firstChild),topCandidate.appendChild(page.firstChild);page.appendChild(topCandidate),this._initializeNode(topCandidate)}else if(topCandidate){for(var alternativeCandidateAncestors=[],i=1;i<topCandidates.length;i++)topCandidates[i].readability.contentScore/topCandidate.readability.contentScore>=.75&&alternativeCandidateAncestors.push(this._getNodeAncestors(topCandidates[i]));var MINIMUM_TOPCANDIDATES=3;if(alternativeCandidateAncestors.length>=3)for(parentOfTopCandidate=topCandidate.parentNode;"BODY"!==parentOfTopCandidate.tagName;){for(var listsContainingThisAncestor=0,ancestorIndex=0;ancestorIndex<alternativeCandidateAncestors.length&&listsContainingThisAncestor<3;ancestorIndex++)listsContainingThisAncestor+=Number(alternativeCandidateAncestors[ancestorIndex].includes(parentOfTopCandidate));if(listsContainingThisAncestor>=3){topCandidate=parentOfTopCandidate;break}parentOfTopCandidate=parentOfTopCandidate.parentNode}topCandidate.readability||this._initializeNode(topCandidate),parentOfTopCandidate=topCandidate.parentNode;for(var lastScore=topCandidate.readability.contentScore,scoreThreshold=lastScore/3;"BODY"!==parentOfTopCandidate.tagName;)if(parentOfTopCandidate.readability){var parentScore=parentOfTopCandidate.readability.contentScore;if(parentScore<scoreThreshold)break;if(parentScore>lastScore){topCandidate=parentOfTopCandidate;break}lastScore=parentOfTopCandidate.readability.contentScore,parentOfTopCandidate=parentOfTopCandidate.parentNode}else parentOfTopCandidate=parentOfTopCandidate.parentNode;for(parentOfTopCandidate=topCandidate.parentNode;"BODY"!=parentOfTopCandidate.tagName&&1==parentOfTopCandidate.children.length;)parentOfTopCandidate=(topCandidate=parentOfTopCandidate).parentNode;topCandidate.readability||this._initializeNode(topCandidate)}var articleContent=doc.createElement("DIV");isPaging&&(articleContent.id="readability-content");for(var siblingScoreThreshold=Math.max(10,.2*topCandidate.readability.contentScore),siblings=(parentOfTopCandidate=topCandidate.parentNode).children,s=0,sl=siblings.length;s<sl;s++){var sibling=siblings[s],append=!1;if(this.log("Looking at sibling node:",sibling,sibling.readability?"with score "+sibling.readability.contentScore:""),this.log("Sibling has score",sibling.readability?sibling.readability.contentScore:"Unknown"),sibling===topCandidate)append=!0;else{var contentBonus=0;if(sibling.className===topCandidate.className&&""!==topCandidate.className&&(contentBonus+=.2*topCandidate.readability.contentScore),sibling.readability&&sibling.readability.contentScore+contentBonus>=siblingScoreThreshold)append=!0;else if("P"===sibling.nodeName){var linkDensity=this._getLinkDensity(sibling),nodeContent=this._getInnerText(sibling),nodeLength=nodeContent.length;nodeLength>80&&linkDensity<.25?append=!0:nodeLength<80&&nodeLength>0&&0===linkDensity&&-1!==nodeContent.search(/\.( |$)/)&&(append=!0)}}append&&(this.log("Appending node:",sibling),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(sibling.nodeName)&&(this.log("Altering sibling:",sibling,"to div."),sibling=this._setNodeTag(sibling,"DIV")),articleContent.appendChild(sibling),siblings=parentOfTopCandidate.children,s-=1,sl-=1)}if(this._debug&&this.log("Article content pre-prep: "+articleContent.innerHTML),this._prepArticle(articleContent),this._debug&&this.log("Article content post-prep: "+articleContent.innerHTML),neededToCreateTopCandidate)topCandidate.id="readability-page-1",topCandidate.className="page";else{var div=doc.createElement("DIV");for(div.id="readability-page-1",div.className="page";articleContent.firstChild;)div.appendChild(articleContent.firstChild);articleContent.appendChild(div)}this._debug&&this.log("Article content after paging: "+articleContent.innerHTML);var parseSuccessful=!0,textLength=this._getInnerText(articleContent,!0).length;if(textLength<this._charThreshold)if(parseSuccessful=!1,page.innerHTML=pageCacheHtml,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:articleContent,textLength:textLength});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:articleContent,textLength:textLength});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:articleContent,textLength:textLength});else{if(this._attempts.push({articleContent:articleContent,textLength:textLength}),this._attempts.sort((function(a,b){return b.textLength-a.textLength})),!this._attempts[0].textLength)return null;articleContent=this._attempts[0].articleContent,parseSuccessful=!0}if(parseSuccessful){var ancestors=[parentOfTopCandidate,topCandidate].concat(this._getNodeAncestors(parentOfTopCandidate));return this._someNode(ancestors,(function(ancestor){if(!ancestor.tagName)return!1;var articleDir=ancestor.getAttribute("dir");return!!articleDir&&(this._articleDir=articleDir,!0)})),articleContent}}},_isValidByline:function(byline){return("string"==typeof byline||byline instanceof String)&&((byline=byline.trim()).length>0&&byline.length<100)},_unescapeHtmlEntities:function(str){if(!str)return str;var htmlEscapeMap=this.HTML_ESCAPE_MAP;return str.replace(/&(quot|amp|apos|lt|gt);/g,(function(_,tag){return htmlEscapeMap[tag]})).replace(/&#(?:x([0-9a-z]{1,4})|([0-9]{1,4}));/gi,(function(_,hex,numStr){var num=parseInt(hex||numStr,hex?16:10);return String.fromCharCode(num)}))},_getJSONLD:function(doc){var scripts=this._getAllNodesWithTag(doc,["script"]),metadata;return this._forEachNode(scripts,(function(jsonLdElement){if(!metadata&&"application/ld+json"===jsonLdElement.getAttribute("type"))try{var content=jsonLdElement.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),parsed=JSON.parse(content);if(!parsed["@context"]||!parsed["@context"].match(/^https?\:\/\/schema\.org$/))return;if(!parsed["@type"]&&Array.isArray(parsed["@graph"])&&(parsed=parsed["@graph"].find((function(it){return(it["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)}))),!parsed||!parsed["@type"]||!parsed["@type"].match(this.REGEXPS.jsonLdArticleTypes))return;if(metadata={},"string"==typeof parsed.name&&"string"==typeof parsed.headline&&parsed.name!==parsed.headline){var title=this._getArticleTitle(),nameMatches=this._textSimilarity(parsed.name,title)>.75,headlineMatches=this._textSimilarity(parsed.headline,title)>.75;metadata.title=headlineMatches&&!nameMatches?parsed.headline:parsed.name}else"string"==typeof parsed.name?metadata.title=parsed.name.trim():"string"==typeof parsed.headline&&(metadata.title=parsed.headline.trim());return parsed.author&&("string"==typeof parsed.author.name?metadata.byline=parsed.author.name.trim():Array.isArray(parsed.author)&&parsed.author[0]&&"string"==typeof parsed.author[0].name&&(metadata.byline=parsed.author.filter((function(author){return author&&"string"==typeof author.name})).map((function(author){return author.name.trim()})).join(", "))),"string"==typeof parsed.description&&(metadata.excerpt=parsed.description.trim()),void(parsed.publisher&&"string"==typeof parsed.publisher.name&&(metadata.siteName=parsed.publisher.name.trim()))}catch(err){this.log(err.message)}})),metadata||{}},_getArticleMetadata:function(jsonld){var metadata={},values={},metaElements=this._doc.getElementsByTagName("meta"),propertyPattern=/\s*(dc|dcterm|og|twitter)\s*:\s*(author|creator|description|title|site_name)\s*/gi,namePattern=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(metaElements,(function(element){var elementName=element.getAttribute("name"),elementProperty=element.getAttribute("property"),content=element.getAttribute("content");if(content){var matches=null,name=null;elementProperty&&(matches=elementProperty.match(propertyPattern))&&(name=matches[0].toLowerCase().replace(/\s/g,""),values[name]=content.trim()),!matches&&elementName&&namePattern.test(elementName)&&(name=elementName,content&&(name=name.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),values[name]=content.trim()))}})),metadata.title=jsonld.title||values["dc:title"]||values["dcterm:title"]||values["og:title"]||values["weibo:article:title"]||values["weibo:webpage:title"]||values.title||values["twitter:title"],metadata.title||(metadata.title=this._getArticleTitle()),metadata.byline=jsonld.byline||values["dc:creator"]||values["dcterm:creator"]||values.author,metadata.excerpt=jsonld.excerpt||values["dc:description"]||values["dcterm:description"]||values["og:description"]||values["weibo:article:description"]||values["weibo:webpage:description"]||values.description||values["twitter:description"],metadata.siteName=jsonld.siteName||values["og:site_name"],metadata.title=this._unescapeHtmlEntities(metadata.title),metadata.byline=this._unescapeHtmlEntities(metadata.byline),metadata.excerpt=this._unescapeHtmlEntities(metadata.excerpt),metadata.siteName=this._unescapeHtmlEntities(metadata.siteName),metadata},_isSingleImage:function(node){return"IMG"===node.tagName||1===node.children.length&&""===node.textContent.trim()&&this._isSingleImage(node.children[0])},_unwrapNoscriptImages:function(doc){var imgs=Array.from(doc.getElementsByTagName("img"));this._forEachNode(imgs,(function(img){for(var i=0;i<img.attributes.length;i++){var attr=img.attributes[i];switch(attr.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(attr.value))return}img.parentNode.removeChild(img)}));var noscripts=Array.from(doc.getElementsByTagName("noscript"));this._forEachNode(noscripts,(function(noscript){var tmp=doc.createElement("div");if(tmp.innerHTML=noscript.innerHTML,this._isSingleImage(tmp)){var prevElement=noscript.previousElementSibling;if(prevElement&&this._isSingleImage(prevElement)){var prevImg=prevElement;"IMG"!==prevImg.tagName&&(prevImg=prevElement.getElementsByTagName("img")[0]);for(var newImg=tmp.getElementsByTagName("img")[0],i=0;i<prevImg.attributes.length;i++){var attr=prevImg.attributes[i];if(""!==attr.value&&("src"===attr.name||"srcset"===attr.name||/\.(jpg|jpeg|png|webp)/i.test(attr.value))){if(newImg.getAttribute(attr.name)===attr.value)continue;var attrName=attr.name;newImg.hasAttribute(attrName)&&(attrName="data-old-"+attrName),newImg.setAttribute(attrName,attr.value)}}noscript.parentNode.replaceChild(tmp.firstElementChild,prevElement)}}}))},_removeScripts:function(doc){this._removeNodes(this._getAllNodesWithTag(doc,["script"]),(function(scriptNode){return scriptNode.nodeValue="",scriptNode.removeAttribute("src"),!0})),this._removeNodes(this._getAllNodesWithTag(doc,["noscript"]))},_hasSingleTagInsideElement:function(element,tag){return 1==element.children.length&&element.children[0].tagName===tag&&!this._someNode(element.childNodes,(function(node){return node.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(node.textContent)}))},_isElementWithoutContent:function(node){return node.nodeType===this.ELEMENT_NODE&&0==node.textContent.trim().length&&(0==node.children.length||node.children.length==node.getElementsByTagName("br").length+node.getElementsByTagName("hr").length)},_hasChildBlockElement:function(element){return this._someNode(element.childNodes,(function(node){return this.DIV_TO_P_ELEMS.has(node.tagName)||this._hasChildBlockElement(node)}))},_isPhrasingContent:function(node){return node.nodeType===this.TEXT_NODE||-1!==this.PHRASING_ELEMS.indexOf(node.tagName)||("A"===node.tagName||"DEL"===node.tagName||"INS"===node.tagName)&&this._everyNode(node.childNodes,this._isPhrasingContent)},_isWhitespace:function(node){return node.nodeType===this.TEXT_NODE&&0===node.textContent.trim().length||node.nodeType===this.ELEMENT_NODE&&"BR"===node.tagName},_getInnerText:function(e,normalizeSpaces){normalizeSpaces=void 0===normalizeSpaces||normalizeSpaces;var textContent=e.textContent.trim();return normalizeSpaces?textContent.replace(this.REGEXPS.normalize," "):textContent},_getCharCount:function(e,s){return s=s||",",this._getInnerText(e).split(s).length-1},_cleanStyles:function(e){if(e&&"svg"!==e.tagName.toLowerCase()){for(var i=0;i<this.PRESENTATIONAL_ATTRIBUTES.length;i++)e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[i]);-1!==this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(e.tagName)&&(e.removeAttribute("width"),e.removeAttribute("height"));for(var cur=e.firstElementChild;null!==cur;)this._cleanStyles(cur),cur=cur.nextElementSibling}},_getLinkDensity:function(element){var textLength=this._getInnerText(element).length;if(0===textLength)return 0;var linkLength=0;return this._forEachNode(element.getElementsByTagName("a"),(function(linkNode){var href=linkNode.getAttribute("href"),coefficient=href&&this.REGEXPS.hashUrl.test(href)?.3:1;linkLength+=this._getInnerText(linkNode).length*coefficient})),linkLength/textLength},_getClassWeight:function(e){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var weight=0;return"string"==typeof e.className&&""!==e.className&&(this.REGEXPS.negative.test(e.className)&&(weight-=25),this.REGEXPS.positive.test(e.className)&&(weight+=25)),"string"==typeof e.id&&""!==e.id&&(this.REGEXPS.negative.test(e.id)&&(weight-=25),this.REGEXPS.positive.test(e.id)&&(weight+=25)),weight},_clean:function(e,tag){var isEmbed=-1!==["object","embed","iframe"].indexOf(tag);this._removeNodes(this._getAllNodesWithTag(e,[tag]),(function(element){if(isEmbed){for(var i=0;i<element.attributes.length;i++)if(this.REGEXPS.videos.test(element.attributes[i].value))return!1;if("object"===element.tagName&&this.REGEXPS.videos.test(element.innerHTML))return!1}return!0}))},_hasAncestorTag:function(node,tagName,maxDepth,filterFn){maxDepth=maxDepth||3,tagName=tagName.toUpperCase();for(var depth=0;node.parentNode;){if(maxDepth>0&&depth>maxDepth)return!1;if(node.parentNode.tagName===tagName&&(!filterFn||filterFn(node.parentNode)))return!0;node=node.parentNode,depth++}return!1},_getRowAndColumnCount:function(table){for(var rows=0,columns=0,trs=table.getElementsByTagName("tr"),i=0;i<trs.length;i++){var rowspan=trs[i].getAttribute("rowspan")||0;rowspan&&(rowspan=parseInt(rowspan,10)),rows+=rowspan||1;for(var columnsInThisRow=0,cells=trs[i].getElementsByTagName("td"),j=0;j<cells.length;j++){var colspan=cells[j].getAttribute("colspan")||0;colspan&&(colspan=parseInt(colspan,10)),columnsInThisRow+=colspan||1}columns=Math.max(columns,columnsInThisRow)}return{rows:rows,columns:columns}},_markDataTables:function(root){for(var tables=root.getElementsByTagName("table"),i=0;i<tables.length;i++){var table=tables[i],role,datatable,summary;if("presentation"!=table.getAttribute("role"))if("0"!=table.getAttribute("datatable"))if(table.getAttribute("summary"))table._readabilityDataTable=!0;else{var caption=table.getElementsByTagName("caption")[0],dataTableDescendants,descendantExists;if(caption&&caption.childNodes.length>0)table._readabilityDataTable=!0;else if(["col","colgroup","tfoot","thead","th"].some((function(tag){return!!table.getElementsByTagName(tag)[0]})))this.log("Data table because found data-y descendant"),table._readabilityDataTable=!0;else if(table.getElementsByTagName("table")[0])table._readabilityDataTable=!1;else{var sizeInfo=this._getRowAndColumnCount(table);sizeInfo.rows>=10||sizeInfo.columns>4?table._readabilityDataTable=!0:table._readabilityDataTable=sizeInfo.rows*sizeInfo.columns>10}}else table._readabilityDataTable=!1;else table._readabilityDataTable=!1}},_fixLazyImages:function(root){this._forEachNode(this._getAllNodesWithTag(root,["img","picture","figure"]),(function(elem){if(elem.src&&this.REGEXPS.b64DataUrl.test(elem.src)){var parts;if("image/svg+xml"===this.REGEXPS.b64DataUrl.exec(elem.src)[1])return;for(var srcCouldBeRemoved=!1,i=0;i<elem.attributes.length;i++){var attr=elem.attributes[i];if("src"!==attr.name&&/\.(jpg|jpeg|png|webp)/i.test(attr.value)){srcCouldBeRemoved=!0;break}}if(srcCouldBeRemoved){var b64starts=elem.src.search(/base64\s*/i)+7,b64length;elem.src.length-b64starts<133&&elem.removeAttribute("src")}}if(!(elem.src||elem.srcset&&"null"!=elem.srcset)||-1!==elem.className.toLowerCase().indexOf("lazy"))for(var j=0;j<elem.attributes.length;j++)if("src"!==(attr=elem.attributes[j]).name&&"srcset"!==attr.name&&"alt"!==attr.name){var copyTo=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(attr.value)?copyTo="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(attr.value)&&(copyTo="src"),copyTo)if("IMG"===elem.tagName||"PICTURE"===elem.tagName)elem.setAttribute(copyTo,attr.value);else if("FIGURE"===elem.tagName&&!this._getAllNodesWithTag(elem,["img","picture"]).length){var img=this._doc.createElement("img");img.setAttribute(copyTo,attr.value),elem.appendChild(img)}}}))},_getTextDensity:function(e,tags){var textLength=this._getInnerText(e,!0).length;if(0===textLength)return 0;var childrenLength=0,children=this._getAllNodesWithTag(e,tags);return this._forEachNode(children,child=>childrenLength+=this._getInnerText(child,!0).length),childrenLength/textLength},_cleanConditionally:function(e,tag){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(e,[tag]),(function(node){var isDataTable=function(t){return t._readabilityDataTable},isList="ul"===tag||"ol"===tag;if(!isList){var listLength=0,listNodes=this._getAllNodesWithTag(node,["ul","ol"]);this._forEachNode(listNodes,list=>listLength+=this._getInnerText(list).length),isList=listLength/this._getInnerText(node).length>.9}if("table"===tag&&isDataTable(node))return!1;if(this._hasAncestorTag(node,"table",-1,isDataTable))return!1;if(this._hasAncestorTag(node,"code"))return!1;var weight=this._getClassWeight(node);this.log("Cleaning Conditionally",node);var contentScore=0;if(weight+0<0)return!0;if(this._getCharCount(node,",")<10){for(var p=node.getElementsByTagName("p").length,img=node.getElementsByTagName("img").length,li=node.getElementsByTagName("li").length-100,input=node.getElementsByTagName("input").length,headingDensity=this._getTextDensity(node,["h1","h2","h3","h4","h5","h6"]),embedCount=0,embeds=this._getAllNodesWithTag(node,["object","embed","iframe"]),i=0;i<embeds.length;i++){for(var j=0;j<embeds[i].attributes.length;j++)if(this.REGEXPS.videos.test(embeds[i].attributes[j].value))return!1;if("object"===embeds[i].tagName&&this.REGEXPS.videos.test(embeds[i].innerHTML))return!1;embedCount++}var linkDensity=this._getLinkDensity(node),contentLength=this._getInnerText(node).length,haveToRemove;return img>1&&p/img<.5&&!this._hasAncestorTag(node,"figure")||!isList&&li>p||input>Math.floor(p/3)||!isList&&headingDensity<.9&&contentLength<25&&(0===img||img>2)&&!this._hasAncestorTag(node,"figure")||!isList&&weight<25&&linkDensity>.2||weight>=25&&linkDensity>.5||1===embedCount&&contentLength<75||embedCount>1}return!1}))},_cleanMatchedNodes:function(e,filter){for(var endOfSearchMarkerNode=this._getNextNode(e,!0),next=this._getNextNode(e);next&&next!=endOfSearchMarkerNode;)next=filter.call(this,next,next.className+" "+next.id)?this._removeAndGetNext(next):this._getNextNode(next)},_cleanHeaders:function(e){let headingNodes=this._getAllNodesWithTag(e,["h1","h2"]);this._removeNodes(headingNodes,(function(node){let shouldRemove=this._getClassWeight(node)<0;return shouldRemove&&this.log("Removing header with low class weight:",node),shouldRemove}))},_headerDuplicatesTitle:function(node){if("H1"!=node.tagName&&"H2"!=node.tagName)return!1;var heading=this._getInnerText(node,!1);return this.log("Evaluating similarity of header:",heading,this._articleTitle),this._textSimilarity(this._articleTitle,heading)>.75},_flagIsActive:function(flag){return(this._flags&flag)>0},_removeFlag:function(flag){this._flags=this._flags&~flag},_isProbablyVisible:function(node){return(!node.style||"none"!=node.style.display)&&!node.hasAttribute("hidden")&&(!node.hasAttribute("aria-hidden")||"true"!=node.getAttribute("aria-hidden")||node.className&&node.className.indexOf&&-1!==node.className.indexOf("fallback-image"))},parse:function(){if(this._maxElemsToParse>0){var numTags=this._doc.getElementsByTagName("*").length;if(numTags>this._maxElemsToParse)throw new Error("Aborting parsing document; "+numTags+" elements found")}this._unwrapNoscriptImages(this._doc);var jsonLd=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var metadata=this._getArticleMetadata(jsonLd);this._articleTitle=metadata.title;var articleContent=this._grabArticle();if(!articleContent)return null;if(this.log("Grabbed: "+articleContent.innerHTML),this._postProcessContent(articleContent),!metadata.excerpt){var paragraphs=articleContent.getElementsByTagName("p");paragraphs.length>0&&(metadata.excerpt=paragraphs[0].textContent.trim())}var textContent=articleContent.textContent;return{title:this._articleTitle,byline:metadata.byline||this._articleByline,dir:this._articleDir,content:this._serializer(articleContent),textContent:textContent,length:textContent.length,excerpt:metadata.excerpt,siteName:metadata.siteName||this._articleSiteName}}},"object"==typeof module&&(module.exports=Readability);